<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Cru Campus Info Finder</title>
  <meta name="description" content="Campus Info Finder">
  <meta name="author" content="SitePoint">

  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.yellow-light_blue.min.css">
  <script src="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.1.0/lodash.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

  <link rel="stylesheet" href="css/styles.css?v=1.0">


<style>
    #map {
        display: inline-block;
        width: 75%;
        height: 100%;
        float: right;

      }

#Campus_Info {
    display: inline-block;
    width: 23%;
    height: 98%;
    background: white;
    margin-top: 10px;
    margin-left: 10px;

}
      .page-content {

        height : 90vh;
        width : 100%;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js"></script>
    <script>
      function initialize() {
        var mapCanvas = document.getElementById('map');
        var mapOptions = {
          center: new google.maps.LatLng(34.0667, -118.0833),
          zoom: 10,
          mapTypeId: google.maps.MapTypeId.ROADMAP


        }
        var map = new google.maps.Map(mapCanvas, mapOptions)
        var infowindowclick = new google.maps.InfoWindow({
          content: "testWindow"
        })
        var infowindowhover = new google.maps.InfoWindow({
          content: "hover window"
        })

        $.getJSON('https://infobase-stage.cru.org/api/v1/target_areas?filters[state]=CA', function (data) {
          console.log(data.target_areas.length);
          window.infobase_campuses = data.target_areas;
          $.getJSON("https://infobase-stage.cru.org/api/v1/govt_scorecard.json" + window.location.search, function (data) {
            $.each(data.govt_scorecard, function (key, val) {
              val.infobase_info = _.find(window.infobase_campuses, {name: val.name});
              if(!val.LATITUDE && val.infobase_info) {
                val.LATITUDE = val.infobase_info.latitude;
                val.LONGITUDE = val.infobase_info.longitude;
              }
              if(val.LATITUDE == undefined) {
                return;
              }
              var marker = new google.maps.Marker({

                position: {lat: Number(val.LATITUDE), lng: Number(val.LONGITUDE)},

                map: map,
                title: val.name,
                campus: val
              });
              marker.addListener('click', function () {
                var campus = this.campus
                var activitieshtml = '';
                if(campus.infobase_info && campus.infobase_info.activities){
                      for(x=0; x<campus.infobase_info.activities.length; x++){
                          activitieshtml +=  '<font size="4">' + campus.infobase_info.activities[x].name + '</font>' + '<br>' +
                                              '<strong>Status:</strong> ' + campus.infobase_info.activities[x].status + '<br>';
                                                  if(campus.infobase_info.activities[x].contacts && campus.infobase_info.activities[x].contacts.length > 0){
                                                    activitieshtml += '<strong>Contact:</strong> ' + campus.infobase_info.activities[x].contacts[0].firstName + ' ' + campus.infobase_info.activities[x].contacts[0].lastName + '<br>';
                                                }
                                                activitieshtml += '<br>';
                      }
                }
                      $('#Campus_Info').html('<div><strong><font size="4">' + campus.name + '</font></strong><br><br>' + activitieshtml + "<br>" + '<strong>Enrollment:</strong> ' + campus.UGDS + '<br> Latino: ' + (campus.UGDS_HISP * 100.0).toFixed(2)
                              + '% <br> Asian: ' + (campus.UGDS_ASIAN * 100.0).toFixed(2) + '% <br> Black: ' + (campus.UGDS_BLACK * 100.0).toFixed(2) + '% </div>');
                infowindowclick.setContent('<div><strong>' + campus.name + '</strong><br>' + '');
                infowindowclick.open(map, this);
                infowindowhover.close();
              });
              marker.addListener('mouseover', function () {
                var campus = this.campus
                infowindowhover.setContent('<div><strong>' + campus.name + '</strong>');
                infowindowhover.open(map, marker);
              });
            })
          })
        });

      }
      google.maps.event.addDomListener(window, 'load', initialize);

    </script>
</head>


<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <header class="mdl-layout__header">
      <div class="mdl-layout__header-row">
        <!-- Title -->
        <span class="mdl-layout-title">Campus Info Finder</span>
        <!-- Add spacer, to align navigation to the right -->
        <div class="mdl-layout-spacer"></div>
        <!-- Navigation. We hide it in small screens. -->
      </div>
    </header>
    <main class="mdl-layout__content">
      <div class="page-content">
          <div id="Campus_Info"></div>

            <div id="map"></div>

      </div>
    </main>
  </div>
  <script src="js/scripts.js"></script>
</body>
</html>
